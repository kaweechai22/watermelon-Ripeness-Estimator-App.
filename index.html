<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡∏á‡πÇ‡∏° </title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#4CAF50" />
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f0f8ff;
      padding: 2rem;
    }
    h1 {
      color: #2e7d32;
    }
    button {
      padding: 1rem 2rem;
      font-size: 1.2rem;
      border: none;
      border-radius: 10px;
      background-color: #4caf50;
      color: white;
      cursor: pointer;
      margin: 0.5rem;
    }
    .result {
      margin-top: 2rem;
      padding: 2rem;
      border-radius: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>‡πÅ‡∏ï‡∏∞‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ñ‡∏≤‡∏∞‡πÅ‡∏ï‡∏á‡πÇ‡∏° üé§üçâ</h1>
  <button onclick="startDetecting()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
  <button onclick="reset()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
  <p id="status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏Ñ‡∏≤‡∏∞...</p>
  <div id="result" class="result"></div>

  <script>
    let audioContext, analyser, dataArray, isListening = false;

    async function startDetecting() {
      document.getElementById("status").innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ñ‡∏≤‡∏∞‡πÅ‡∏ï‡∏á‡πÇ‡∏°‡πÉ‡∏Å‡∏•‡πâ‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô";
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const source = audioContext.createMediaStreamSource(stream);
      analyser = audioContext.createAnalyser();
      analyser.fftSize = 2048;
      const bufferLength = analyser.frequencyBinCount;
      dataArray = new Uint8Array(bufferLength);
      source.connect(analyser);
      isListening = true;
      listen();
    }

    function listen() {
      if (!isListening) return;
      analyser.getByteFrequencyData(dataArray);
      const sampleRate = audioContext.sampleRate;
      const binSize = sampleRate / analyser.fftSize;
      let maxAmp = 0;
      let peakFreq = 0;

      for (let i = 0; i < dataArray.length; i++) {
        const freq = i * binSize;
        const amp = dataArray[i];
        if (freq >= 100 && freq <= 900 && amp > maxAmp) {
          maxAmp = amp;
          peakFreq = freq;
        }
      }

      if (peakFreq) {
        isListening = false;
        document.getElementById("status").innerText = `‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà: ${peakFreq.toFixed(2)} Hz`;
        showResult(peakFreq);
      } else {
        requestAnimationFrame(listen);
      }
    }

    function showResult(freq) {
      let level = "", color = "";
      if (freq > 500) {
        level = "‡∏î‡∏¥‡∏ö"; color = "#4caf50";
      } else if (freq > 450) {
        level = "‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏∏‡∏Å"; color = "#ffeb3b";
      } else if (freq >= 350) {
        level = "‡∏™‡∏∏‡∏Å‡∏û‡∏≠‡∏î‡∏µ"; color = "#ff9800";
      } else {
        level = "‡∏≠‡∏≤‡∏à‡πÄ‡∏ô‡πà‡∏≤"; color = "#9e9e9e";
      }
      const result = document.getElementById("result");
      result.style.backgroundColor = color;
      result.innerHTML = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà: ${freq.toFixed(2)} Hz<br>‡∏£‡∏∞‡∏î‡∏±‡∏ö: ${level}`;
    }

    function reset() {
      isListening = false;
      document.getElementById("status").innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏Ñ‡∏≤‡∏∞...";
      document.getElementById("result").innerHTML = "";
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
