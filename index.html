<button onclick="startListening()">üéôÔ∏è ‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏Ñ‡∏≤‡∏∞‡πÅ‡∏ï‡∏á‡πÇ‡∏°</button>
<p id="micStatus">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡∏Ñ‡πå: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°</p>

<script>
let audioContext;
let micStream;
let analyser;
let dataArray;
let isListening = false;

function autoCorrelate(buffer, sampleRate) {
  let SIZE = buffer.length;
  let MAX_SAMPLES = Math.floor(SIZE / 2);
  let bestOffset = -1;
  let bestCorrelation = 0;
  let rms = 0;

  for (let i = 0; i < SIZE; i++) {
    let val = buffer[i];
    rms += val * val;
  }
  rms = Math.sqrt(rms / SIZE);
  if (rms < 0.01) return -1;

  let lastCorrelation = 1;
  for (let offset = 1; offset < MAX_SAMPLES; offset++) {
    let correlation = 0;
    for (let i = 0; i < MAX_SAMPLES; i++) {
      correlation += Math.abs(buffer[i] - buffer[i + offset]);
    }
    correlation = 1 - (correlation / MAX_SAMPLES);
    if (correlation > 0.9 && correlation > lastCorrelation) {
      bestCorrelation = correlation;
      bestOffset = offset;
    }
    lastCorrelation = correlation;
  }

  if (bestCorrelation > 0.9) {
    return sampleRate / bestOffset;
  } else {
    return -1;
  }
}

async function startListening() {
  if (isListening) return;

  isListening = true;
  document.getElementById("micStatus").innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡∏Ñ‡πå: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á...";

  audioContext = new (window.AudioContext || window.webkitAudioContext)();
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  micStream = audioContext.createMediaStreamSource(stream);
  analyser = audioContext.createAnalyser();
  analyser.fftSize = 2048;

  micStream.connect(analyser);
  dataArray = new Float32Array(analyser.fftSize);

  listenFrequency();
}

function listenFrequency() {
  analyser.getFloatTimeDomainData(dataArray);
  let freq = autoCorrelate(dataArray, audioContext.sampleRate);
  if (freq > 50 && freq < 2000) {
    document.getElementById("micStatus").innerText = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ: ${freq.toFixed(2)} Hz`;
    document.getElementById(`freq${inputCount}`)?.remove?.();
    if (inputCount < maxInputs) {
      const input = document.createElement("input");
      input.type = "number";
      input.value = freq.toFixed(2);
      input.id = `freq${inputCount}`;
      input.style.display = \"none\"; // ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ
      document.getElementById(\"freqInputs\").appendChild(input);
      inputCount++;
    }
  } else {
    document.getElementById(\"micStatus\").innerText = \"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á... (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô)\";
  }

  if (inputCount < maxInputs) {
    requestAnimationFrame(listenFrequency);
  } else {
    document.getElementById(\"micStatus\").innerText = \"‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏ö 5 ‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì\"; 
    isListening = false;
  }
}
</script>
edit1
